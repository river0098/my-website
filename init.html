<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>LeanCloud æ•°æ®è¡¨åˆå§‹åŒ–å·¥å…·</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-min.js"></script>
<style>
  body {
    font-family: -apple-system, "Microsoft YaHei", Arial, sans-serif;
    max-width: 800px;
    margin: 50px auto;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
  }
  
  .container {
    background: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }
  
  h1 {
    color: #333;
    text-align: center;
    margin-bottom: 30px;
  }
  
  .status {
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
    text-align: center;
  }
  
  .status.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  
  .status.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }
  
  .status.info {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
  }
  
  .status.warning {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
  }
  
  button {
    display: block;
    width: 100%;
    padding: 15px 30px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    margin: 20px 0;
    transition: all 0.3s;
  }
  
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(102,126,234,0.3);
  }
  
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  
  .progress-list {
    list-style: none;
    padding: 0;
    margin: 20px 0;
  }
  
  .progress-item {
    padding: 10px;
    margin: 10px 0;
    background: #f8f9fa;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .progress-item.complete {
    background: #d4edda;
  }
  
  .progress-item.error {
    background: #f8d7da;
  }
  
  .spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .check {
    color: #28a745;
    font-size: 20px;
  }
  
  .cross {
    color: #dc3545;
    font-size: 20px;
  }
  
  pre {
    background: #f4f4f4;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 14px;
    margin: 15px 0;
  }
  
  .sample-data {
    background: #f0f8ff;
    border: 2px dashed #667eea;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
  }
  
  .sample-data h3 {
    color: #667eea;
    margin-bottom: 15px;
  }
  
  .sample-data p {
    color: #666;
    line-height: 1.6;
  }
</style>
</head>
<body>

<div class="container">
  <h1>ğŸš€ LeanCloud æ•°æ®è¡¨åˆå§‹åŒ–å·¥å…·</h1>
  
  <div id="status" class="status info">
    å‡†å¤‡è¿æ¥ LeanCloud...
  </div>
  
  <button id="initBtn" onclick="startInitialization()">
    å¼€å§‹åˆå§‹åŒ–æ•°æ®è¡¨
  </button>
  
  <ul class="progress-list" id="progressList" style="display:none">
    <li class="progress-item" id="progress-questions">
      <span id="icon-questions" class="spinner"></span>
      <span>Questions è¡¨ï¼ˆé¢˜åº“ï¼‰</span>
    </li>
    <li class="progress-item" id="progress-scores">
      <span id="icon-scores" class="spinner"></span>
      <span>Scores è¡¨ï¼ˆæˆç»©è®°å½•ï¼‰</span>
    </li>
    <li class="progress-item" id="progress-progress">
      <span id="icon-progress" class="spinner"></span>
      <span>Progress è¡¨ï¼ˆå­¦ä¹ è¿›åº¦ï¼‰</span>
    </li>
    <li class="progress-item" id="progress-sample">
      <span id="icon-sample" class="spinner"></span>
      <span>æ·»åŠ ç¤ºä¾‹é¢˜ç›®</span>
    </li>
  </ul>
  
  <div id="result" style="display:none">
    <h2>âœ… åˆå§‹åŒ–å®Œæˆï¼</h2>
    <div class="status success">
      æ‰€æœ‰æ•°æ®è¡¨å·²åˆ›å»ºæˆåŠŸï¼Œç³»ç»Ÿå·²å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼
    </div>
    
    <div class="sample-data">
      <h3>ğŸ“š å·²æ·»åŠ çš„ç¤ºä¾‹é¢˜ç›®ï¼š</h3>
      <ul id="sampleList"></ul>
    </div>
    
    <h3>ä¸‹ä¸€æ­¥ï¼š</h3>
    <ol style="line-height: 2">
      <li>è¿”å›æ‚¨çš„è‹±è¯­æåˆ†ç³»ç»Ÿ</li>
      <li>é€‰æ‹©å­¦ç”Ÿå¼€å§‹ç»ƒä¹ </li>
      <li>ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æ‰€æœ‰ç»ƒä¹ è®°å½•</li>
      <li>åœ¨"æˆç»©æŠ¥å‘Š"æŸ¥çœ‹å­¦ä¹ è¿›åº¦</li>
    </ol>
  </div>
  
  <div id="error" style="display:none">
    <div class="status error">
      <strong>å‡ºç°é”™è¯¯ï¼š</strong>
      <p id="errorMsg"></p>
    </div>
  </div>
</div>

<script>
// LeanCloud é…ç½®
const CONFIG = {
  appId: 'WCOw44sgcriKsHGjR273OqON-gzGzoHsz',
  appKey: 'tIJYmWK76EfPs2TEIi0Pd2in',
  serverURL: 'https://wcow44sg.lc-cn-n1-shared.com'
};

// ç¤ºä¾‹é¢˜ç›®æ•°æ®
const SAMPLE_QUESTIONS = [
  {
    question: 'What is the Chinese meaning of "apple"?',
    type: 'choice',
    options: ['è‹¹æœ', 'é¦™è•‰', 'æ©™å­', 'æ¢¨å­'],
    answer: 'è‹¹æœ',
    difficulty: 1,
    category: 'word'
  },
  {
    question: 'What does "happy" mean?',
    type: 'choice',
    options: ['æ‚²ä¼¤çš„', 'å¿«ä¹çš„', 'ç”Ÿæ°”çš„', 'ç´¯çš„'],
    answer: 'å¿«ä¹çš„',
    difficulty: 1,
    category: 'word'
  },
  {
    question: 'Choose the correct word: I ___ a student.',
    type: 'choice',
    options: ['am', 'is', 'are', 'be'],
    answer: 'am',
    difficulty: 1,
    category: 'grammar'
  },
  {
    question: 'She ___ to school every day.',
    type: 'choice',
    options: ['go', 'goes', 'going', 'went'],
    answer: 'goes',
    difficulty: 2,
    category: 'grammar'
  },
  {
    question: 'They ___ playing basketball now.',
    type: 'choice',
    options: ['is', 'am', 'are', 'be'],
    answer: 'are',
    difficulty: 2,
    category: 'grammar'
  },
  {
    question: 'The book is ___ the table. (åœ¨...ä¸Šé¢)',
    type: 'fill',
    options: [],
    answer: 'on',
    difficulty: 1,
    category: 'grammar'
  },
  {
    question: 'My name ___ Tom. (æ˜¯)',
    type: 'fill',
    options: [],
    answer: 'is',
    difficulty: 1,
    category: 'grammar'
  },
  {
    question: 'I like ___ (è‹¹æœ).',
    type: 'fill',
    options: [],
    answer: 'apples',
    difficulty: 2,
    category: 'word'
  },
  {
    question: 'è¯·ç¿»è¯‘ï¼šI am a student',
    type: 'translation',
    options: [],
    answer: 'æˆ‘æ˜¯ä¸€ä¸ªå­¦ç”Ÿ',
    difficulty: 1,
    category: 'sentence'
  },
  {
    question: 'è¯·ç¿»è¯‘ï¼šShe likes reading books',
    type: 'translation',
    options: [],
    answer: 'å¥¹å–œæ¬¢è¯»ä¹¦',
    difficulty: 2,
    category: 'sentence'
  },
  {
    question: 'è¯·ç¿»è¯‘ï¼šGood morning',
    type: 'translation',
    options: [],
    answer: 'æ—©ä¸Šå¥½',
    difficulty: 1,
    category: 'sentence'
  },
  {
    question: 'è¯·ç¿»è¯‘ï¼šThank you very much',
    type: 'translation',
    options: [],
    answer: 'éå¸¸æ„Ÿè°¢',
    difficulty: 1,
    category: 'sentence'
  },
  {
    question: 'What color is the sky?',
    type: 'choice',
    options: ['Red', 'Blue', 'Green', 'Yellow'],
    answer: 'Blue',
    difficulty: 1,
    category: 'word'
  },
  {
    question: 'How many days are there in a week?',
    type: 'choice',
    options: ['5', '6', '7', '8'],
    answer: '7',
    difficulty: 1,
    category: 'word'
  },
  {
    question: 'The opposite of "big" is ___.',
    type: 'fill',
    options: [],
    answer: 'small',
    difficulty: 2,
    category: 'word'
  }
];

// åˆå§‹åŒ– LeanCloud
async function init() {
  const statusEl = document.getElementById('status');
  
  try {
    AV.init({
      appId: CONFIG.appId,
      appKey: CONFIG.appKey,
      serverURL: CONFIG.serverURL
    });
    
    statusEl.className = 'status success';
    statusEl.textContent = 'âœ“ å·²è¿æ¥åˆ° LeanCloud';
    
    return true;
  } catch (error) {
    statusEl.className = 'status error';
    statusEl.textContent = 'âœ— è¿æ¥å¤±è´¥: ' + error.message;
    document.getElementById('initBtn').disabled = true;
    return false;
  }
}

// æ›´æ–°è¿›åº¦æ˜¾ç¤º
function updateProgress(tableName, status) {
  const item = document.getElementById('progress-' + tableName);
  const icon = document.getElementById('icon-' + tableName);
  
  if (status === 'complete') {
    item.classList.add('complete');
    icon.className = 'check';
    icon.innerHTML = 'âœ“';
  } else if (status === 'error') {
    item.classList.add('error');
    icon.className = 'cross';
    icon.innerHTML = 'âœ—';
  } else {
    icon.className = 'spinner';
    icon.innerHTML = '';
  }
}

// å¼€å§‹åˆå§‹åŒ–
async function startInitialization() {
  const btn = document.getElementById('initBtn');
  const progressList = document.getElementById('progressList');
  const status = document.getElementById('status');
  
  btn.disabled = true;
  btn.textContent = 'æ­£åœ¨åˆå§‹åŒ–...';
  progressList.style.display = 'block';
  status.style.display = 'none';
  
  try {
    // åˆå§‹åŒ–è¿æ¥
    const connected = await init();
    if (!connected) {
      throw new Error('æ— æ³•è¿æ¥åˆ° LeanCloud');
    }
    
    // åˆ›å»º Questions è¡¨å’Œæ·»åŠ ç¤ºä¾‹é¢˜ç›®
    await createQuestionsTable();
    updateProgress('questions', 'complete');
    
    // åˆ›å»º Scores è¡¨
    await createScoresTable();
    updateProgress('scores', 'complete');
    
    // åˆ›å»º Progress è¡¨
    await createProgressTable();
    updateProgress('progress', 'complete');
    
    // æ·»åŠ ç¤ºä¾‹é¢˜ç›®
    const addedQuestions = await addSampleQuestions();
    updateProgress('sample', 'complete');
    
    // æ˜¾ç¤ºç»“æœ
    showSuccess(addedQuestions);
    
  } catch (error) {
    showError(error.message);
  }
}

// åˆ›å»º Questions è¡¨
async function createQuestionsTable() {
  // LeanCloud ä¼šåœ¨é¦–æ¬¡ä¿å­˜æ•°æ®æ—¶è‡ªåŠ¨åˆ›å»ºè¡¨
  // æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸€æ¡æµ‹è¯•æ•°æ®æ¥åˆ›å»ºè¡¨ç»“æ„
  const Question = AV.Object.extend('Questions');
  const test = new Question();
  
  // è®¾ç½®æ‰€æœ‰å­—æ®µä»¥ç¡®ä¿è¡¨ç»“æ„å®Œæ•´
  test.set('question', 'TEST');
  test.set('type', 'test');
  test.set('answer', 'test');
  test.set('options', []);
  test.set('difficulty', 1);
  test.set('category', 'test');
  
  await test.save();
  
  // åˆ é™¤æµ‹è¯•æ•°æ®
  await test.destroy();
  
  console.log('Questions è¡¨åˆ›å»ºæˆåŠŸ');
}

// åˆ›å»º Scores è¡¨
async function createScoresTable() {
  const Score = AV.Object.extend('Scores');
  const test = new Score();
  
  test.set('studentId', 'test');
  test.set('studentName', 'test');
  test.set('questionId', 'test');
  test.set('userAnswer', 'test');
  test.set('isCorrect', false);
  test.set('score', 0);
  test.set('practiceDate', new Date());
  
  await test.save();
  await test.destroy();
  
  console.log('Scores è¡¨åˆ›å»ºæˆåŠŸ');
}

// åˆ›å»º Progress è¡¨
async function createProgressTable() {
  const Progress = AV.Object.extend('Progress');
  const test = new Progress();
  
  test.set('studentId', 'test');
  test.set('studentName', 'test');
  test.set('totalQuestions', 0);
  test.set('correctCount', 0);
  test.set('accuracy', 0);
  test.set('lastPractice', new Date());
  
  await test.save();
  await test.destroy();
  
  console.log('Progress è¡¨åˆ›å»ºæˆåŠŸ');
}

// æ·»åŠ ç¤ºä¾‹é¢˜ç›®
async function addSampleQuestions() {
  const addedQuestions = [];
  
  // æ£€æŸ¥æ˜¯å¦å·²æœ‰é¢˜ç›®
  const checkQuery = new AV.Query('Questions');
  checkQuery.limit(1);
  const existing = await checkQuery.find();
  
  if (existing.length > 0) {
    console.log('é¢˜ç›®å·²å­˜åœ¨ï¼Œè·³è¿‡æ·»åŠ ');
    return ['é¢˜ç›®å·²å­˜åœ¨ï¼Œæœªé‡å¤æ·»åŠ '];
  }
  
  // æ‰¹é‡æ·»åŠ é¢˜ç›®
  for (let q of SAMPLE_QUESTIONS) {
    const Question = AV.Object.extend('Questions');
    const question = new Question();
    
    question.set('question', q.question);
    question.set('type', q.type);
    question.set('answer', q.answer);
    question.set('options', q.options);
    question.set('difficulty', q.difficulty);
    question.set('category', q.category);
    
    await question.save();
    addedQuestions.push(q.question);
  }
  
  return addedQuestions;
}

// æ˜¾ç¤ºæˆåŠŸç»“æœ
function showSuccess(questions) {
  document.getElementById('progressList').style.display = 'none';
  document.getElementById('initBtn').style.display = 'none';
  document.getElementById('result').style.display = 'block';
  
  const list = document.getElementById('sampleList');
  list.innerHTML = questions.map(q => `<li>${q}</li>`).join('');
}

// æ˜¾ç¤ºé”™è¯¯
function showError(message) {
  document.getElementById('progressList').style.display = 'none';
  document.getElementById('initBtn').disabled = false;
  document.getElementById('initBtn').textContent = 'é‡æ–°å°è¯•';
  document.getElementById('error').style.display = 'block';
  document.getElementById('errorMsg').textContent = message;
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.addEventListener('DOMContentLoaded', async () => {
  await init();
});
</script>

</body>
</html>